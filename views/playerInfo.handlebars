<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/" style="text-decoration: none;">Home</a></li>
    <li class="breadcrumb-item"><a href="/players" style="text-decoration: none;">Players</a></li>
    <li class="breadcrumb-item active" aria-current="page" id="breadcrumb_tag">{{playerStats.tag}}</li>
  </ol>
</nav>

<!-- Tabs -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <a class="nav-link active" id="general-tab" data-toggle="tab" href="#general" role="tab" aria-controls="general"
      aria-selected="true">GENERAL</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="battles-tab" data-toggle="tab" href="#battles" role="tab" aria-controls="battles"
      aria-selected="false">BATTLES</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="cards-tab" data-toggle="tab" href="#cards" role="tab" aria-controls="cards"
      aria-selected="false">CARDS</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="chests-tab" data-toggle="tab" href="#chests" role="tab" aria-controls="chests"
      aria-selected="false">CHESTS</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="analysis-tab" data-toggle="tab" href="#analysis" role="tab" aria-controls="analysis"
      aria-selected="false">ANALYSIS</a>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content mx-2">
  <div class="tab-pane active mx-4 my-4" id="general" role="tabpanel" aria-labelledby="general-tab">
    {{#with playerStats}}
      <h1>{{name}}</h1>
      <h2>
        <img class="" src="/images/ladder/trophy.png" alt="trophy" style="width: 45px;"> 
        {{bestTrophies}} PB
      </h2>
      {{#if role}}
        <h3><a class="text-decoration-none" href="/clans/{{removeFirstCharacter clan.tag}}">{{clan.name}}</a> [{{correctClanRoleCapitalization role}}]</h3>
      {{else}}
        <h3 class="font-italic">Not in Clan</h3>
      {{/if}}
      <div class="accordion pt-4 mx-0" id="playerInfo">
        <div class="card">
          <div class="card-header" style="" id="headingOne">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne" style="font-size: 0.7em;">
                League Royale
              </button>
            </h2>
          </div>
          <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#playerInfo">
            <div class="card-body" style="">
              {{#if leagueStatistics}}
                {{#with leagueStatistics}}
                  <div class="container-fluid pt-4">
                    <div class="row justify-content-center">
                      {{#with currentSeason}}
                        <div class="leagueRoyaleCardStyle">
                          <img src="/images/ladder/{{getLeague trophies}}.png" class="card-img-top" alt="{{getLeague trophies}}">
                          <div class="card-body">
                            <h5 class="card-title text-center font-weight-bold">Current Season</h5>
                            <p class="card-text">Current Trophies: {{trophies}}</p>
                            <p class="card-text">Best Trophies: {{bestTrophies}}</p>
                            {{#if rank}}
                              <p class="card-text">Current Rank: {{rank}}</p>
                            {{else}}
                              <p class="card-text">Current Rank: Not Ranked</p>
                            {{/if}}
                          </div>
                        </div>
                      {{/with}}
                      {{#with previousSeason}}
                        <div class="leagueRoyaleCardStyle">
                          <img src="/images/ladder/{{getLeague trophies}}.png" class="card-img-top" alt="{{getLeague trophies}}">
                          <div class="card-body">
                            <h5 class="card-title text-center font-weight-bold">Previous Season</h5>
                            <p class="card-text">End Trophies: {{trophies}}</p>
                            <p class="card-text">Best Trophies: {{bestTrophies}}</p>
                            {{#if rank}}
                              <p class="card-text">Rank: {{rank}}</p>
                            {{else}}
                              <p class="card-text">Rank: Not Ranked</p>
                            {{/if}}
                          </div>
                        </div>
                      {{/with}}
                      {{#with bestSeason}}
                        <div class="leagueRoyaleCardStyle">
                          <img src="/images/ladder/{{getLeague trophies}}.png" class="card-img-top" alt="{{getLeague trophies}}">
                          <div class="card-body">
                            <h5 class="card-title text-center font-weight-bold">Best Season</h5>
                            <p class="card-text">Season: {{id}}</p>
                            <p class="card-text">Trophies: {{trophies}}</p>
                            {{#if rank}}
                              <p class="card-text">Rank: {{rank}}</p>
                            {{else}}
                              <p class="card-text">Rank: Not Ranked</p>
                            {{/if}}
                          </div>
                        </div>
                      {{/with}}
                    </div>
                  </div>
                {{/with}}
              {{else}}
                <div class="alert alert-primary text-center" role="alert">
                  This player does not have any league info
                </div>
              {{/if}}
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingTwo">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" style="font-size: 0.7em;">
                Challenge Royale
              </button>
            </h2>
          </div>
          <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#playerInfo">
            <div class="card-body">
              <div class="container-fluid pt-4">
                <div class="row justify-content-center">
                  <div class="challengeRoyaleCardStyle">
                    <img src="/images/challenges/CRL Logo.png" class="card-img-top" alt="CRL Logo">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Challenge Stats</h5>
                      <p class="card-text"><a data-bs-toggle="tooltip" data-bs-placement="top" title="Without Continues">Max Challenge Wins: {{challengeMaxWins}}*</a></p>
                      <p class="card-text">Challenge Cards Won: {{challengeCardsWon}}</p>
                    </div>
                  </div>
                  <div class="challengeRoyaleCardStyle">
                    <img src="/images/challenges/Classic Challenge.png" class="card-img-top" alt="Classic Challenge Logo">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Classic Challenge Wins</h5>
                      <h1 class="font-weight-light text-center">{{findCCGCWins "CC" badges}}</h1>
                    </div>
                  </div>
                  <div class="challengeRoyaleCardStyle">
                    <img src="/images/challenges/Grand Challenge.png" class="card-img-top" alt="Grand Challenge Logo">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Grand Challenge Wins</h5>
                      <h1 class="font-weight-light text-center">{{findCCGCWins "GC" badges}}</h1>
                    </div>
                  </div>
                  <div class="challengeRoyaleCardStyle">
                    <img src="/images/challenges/Tournament.png" class="card-img-top" alt="Tournament Logo">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Tournaments</h5>
                      <p class="card-text">Tournament Games Played: {{tournamentBattleCount}}</p>
                      <p class="card-text">Tournament Cards Won: {{tournamentCardsWon}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingThree">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree" style="font-size: 0.7em;">
                Clan Royale
              </button>
            </h2>
          </div>
          <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#playerInfo">
            <div class="card-body">
              <div class="container-fluid pt-4">
                <div class="row justify-content-center">
                  <div class="clanRoyaleCardStyle">
                    <img src="/images/misc/cards.png" class="card-img-top" alt="Donation Cards" style="margin-bottom: 19.169px;">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Total Donations</h5>
                      <h1 class="font-weight-light text-center">{{totalDonations}}</h1>
                    </div>
                  </div>
                  <div class="clanRoyaleCardStyle">
                    <img src="/images/clans/War Shield v4.png" class="card-img-top" alt="War Shield" style="margin-bottom: 0px;">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">War Day Wins</h5>
                      <h1 class="font-weight-light text-center">{{warDayWins}}</h1>
                    </div>
                    <div class="card-footer" style="background-color: mintcream;">
                      <small class="text-muted">Clan Wars Veteran</small>
                    </div>
                  </div>
                  <div class="clanRoyaleCardStyle">
                    <img src="/images/clans/Clan Cards.png" class="card-img-top" alt="Clan Cards" style="margin-bottom: 29.9px;">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">Clan Cards Collected</h5>
                      <h1 class="font-weight-light text-center">{{clanCardsCollected}}</h1>
                    </div>
                    <div class="card-footer" style="background-color: mintcream;">
                      <small class="text-muted">Clan Wars Veteran</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingFour">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour" style="font-size: 0.7em;">
                Battle Royale
              </button>
            </h2>
          </div>
          <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#playerInfo">
            <div class="card-body">
              <div class="container-fluid pt-4">
                <div class="row justify-content-center">
                  <div class="battleRoyaleCardStyle">
                    <img src="/images/battles/King and the Crowd Illustration v3.png" class="card-img-top" alt="King and the Crowd">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Ladder and Challenges</h5>
                      <p class="card-text mb-0">Total Wins: {{wins}}</p>
                      <p class="card-text small font-weight-light font-italic">Percent Wins: {{round (math (math wins "/" (math wins "+" losses)) "*" 100) 3}}%</p>
                      <p class="card-text mb-0">Total Losses: {{losses}}</p>
                      <p class="card-text small font-weight-light font-italic">Percent Losses: {{round (math (math losses "/" (math wins "+" losses)) "*" 100) 3}}%</p>
                      <p class="card-text mb-0">Total Games: {{math wins "+" losses}}</p>
                    </div>
                  </div>
                  <div class="battleRoyaleCardStyle">
                    <img src="/images/battles/2v2.png" class="card-img-top" alt="2v2 Logo">
                    <div class="card-body">
                      <h5 class="card-title text-center font-weight-bold">2v2 Games (and 1v1 draws)</h5>
                      <h1 class="font-weight-light text-center">{{math battleCount "-" (math wins "+" losses)}}</h1>
                    </div>
                  </div>
                  <div class="battleRoyaleCardStyle">
                    <img src="/images/battles/Three Crowns.png" class="card-img-top" alt="Three Crowns Picture">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Three Crown Wins</h5>
                      <h1 class="font-weight-light text-center">{{threeCrownWins}}</h1>
                    </div>
                  </div>
                  <div class="battleRoyaleCardStyle">
                    <img src="/images/battles/Battle.png" class="card-img-top" alt="Battle Logo">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Total Games</h5>
                      <h1 class="font-weight-light text-center">{{battleCount}}</h1>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingFive">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive" style="font-size: 0.7em;">
                Badge Royale
              </button>
            </h2>
          </div>
          <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#playerInfo">
            <div class="card-body">
              <div class="container-fluid pt-4">
                <div class="row justify-content-center">
                  {{#each badges}}
                    <div class="badgeRoyaleCardStyle">
                      <h6 class="font-weight-bold text-center mb-4" style="height: 45px;">{{getBadgeName name progress}}</h6>
                      <img src="{{getBadgeImage name progress}}" class="card-img-top badge-royale-image" alt={{name}}>
                      <div class="card-body">
                        <h2 class="font-weight-light text-center">{{displayBadgeValue name level progress}}</h2>
                      </div>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingSix">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix" style="font-size: 0.7em;">
                Achievement Royale
              </button>
            </h2>
          </div>
          <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#playerInfo">
            <div class="card-body">
              <div class="alert alert-info text-center mb-0" role="alert">
                Achievements are no longer shown in the game, but since they are still tracked, they are displayed below.
              </div>
              <div class="container-fluid pt-3">
                <div class="row justify-content-center">
                  {{#each achievements}}
                    <div class="achievementRoyaleCardStyle">
                      <h5 class="font-weight-bold text-center mb-3" style="height: 40px;">{{name}}</h5>
                      <img src="{{getAchievementImage name value}}" class="card-img-top" alt={{name}} style="height: 200px;">
                      <div class="card-body">
                        <div class="container-fluid mx-0 px-0 mb-2" style="height: 40px;">
                          <div class="row justify-content-center">
                            {{{loopHTML stars "<img src=\"/images/misc/star v2.png\" class = \"mb-0 mt-3 mx-0\" style = \"width: 25px;\" alt=\"cartoon_star\">"}}}
                          </div>
                        </div>
                        {{#if (compare name "===" "Challenge Streak")}}
                          <p class="card-text text-center" style="height: 50px;"><a data-bs-toggle="tooltip" data-bs-placement="top" title="With or Without Continues">{{displayAchievementValue name value}}*</a></p>
                        {{else}}
                          <p class="card-text text-center" style="height: 50px;">{{displayAchievementValue name value}}</p>
                        {{/if}}
                      </div>
                      <div class="card-footer" style="background-color: mintcream;">
                        {{{achievementLevels name}}}
                      </div>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header" id="headingSeven">
            <h2 class="mb-0">
              <button class="btn btn-block btn-link text-decoration-none text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven" style="font-size: 0.7em;">
                Miscellaneous Royale
              </button>
            </h2>
          </div>
          <div id="collapseSeven" class="collapse" aria-labelledby="headingSeven" data-parent="#playerInfo">
            <div class="card-body">
              <div class="container-fluid pt-3">
                <div class="row justify-content-center">
                  <div class="miscellaneousRoyaleCardStyle">
                    <img src="/images/misc/Experience.png" class="card-img-top" alt="Experience" style="height: 200px;">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Experience</h5>
                      <h1 class="font-weight-light text-center">Level {{expLevel}}</h1>
                    </div>
                  </div>
                  <div class="miscellaneousRoyaleCardStyle">
                    <img src="/images/misc/cards.png" class="card-img-top" alt="cards" style="height: 200px;">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Cards Found</h5>
                      <h1 class="font-weight-light text-center">{{objectLength cards}}</h1>
                    </div>
                  </div>
                  <div class="miscellaneousRoyaleCardStyle">
                    <img src="/images/misc/clock.png" class="card-img-top" alt="clock" style="height: 200px;">
                    <div class="card-body">
                      <h5 class="card-title font-weight-bold text-center">Account Since</h5>
                      <h2 class="font-weight-light text-center px-0 mx-0">{{startDate badges}}</h2>
                    </div>
                  </div>
                  <div class="miscellaneousRoyaleCardStyle">
                    <h5 class="card-title font-weight-bold text-center">Current Deck</h5>
                    <div class="container-fluid mx-0 px-0 mt-0">
                      <div class="row justify-content-center">
                        {{#each currentDeck}}
                          <div class="mx-1">
                            <img src="/images/cards/{{name}}.png" class="my-2" alt="{{name}}" width="70px;" style="">
                          </div>
                        {{/each}}
                      </div>
                    </div>
                  </div>
                  <div class="miscellaneousRoyaleCardStyle">
                    <h5 class="card-title font-weight-bold text-center">Favorite Card</h5>
                    <img src="/images/cards/{{currentFavouriteCard.name}}.png" class="my-2" alt="{{currentFavouriteCard.name}}" style="height: 250px;">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {{/with}}
  </div>

  <div class="tab-pane mx-2 my-4 px-1" id="battles" role="tabpanel" aria-labelledby="battles-tab">
    {{#if playerBattles}}
    {{else}}
      <!--Idk how to do a "NOT" with handlebars, so I just use the else part of an if-->
      <!--This code should really only apply to inactive players-->
      <div class="alert alert-primary text-center" role="alert">
        No battles are available for this player
      </div>
    {{/if}}
    {{#each playerBattles}}
      {{#if (compare type "!==" "boatBattle")}}
        <div class="card my-4 container-fluid" style="background-color:beige;">
          <div class="container-fluid">
            <h2 class="mt-4 mb-3">{{gameModeName gameMode.id gameMode.name}}</h2>
            <div>
              <h3>
                <a href="/players/{{removeFirstCharacter team.0.tag}}" class="text-decoration-none">
                  {{team.0.name}} [{{team.0.tag}}]
                </a>
              </h3>
              <div class="container-fluid mx-0 px-0 mt-0">
                <div class="row">
                  {{#each team.0.cards}}
                    <div class="mx-1">
                      <img src="/images/cards/{{name}}.png" class="my-2 battle-cards" alt="{{name}}" width="100" style="">
                      <p class="my-0" style="text-align: center;">Lvl {{calculateCardLevel level maxLevel}}</p>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
            <div>
              {{#if team.1.tag}}
                <h3 class="mt-3 mb-2">
                  <a href="/players/{{removeFirstCharacter team.1.tag}}" class="text-decoration-none">
                    {{team.1.name}} [{{team.1.tag}}]
                  </a>
                </h3>
                <div class="container-fluid mx-0 px-0">
                  <div class="row">
                    {{#each team.1.cards}}
                      <div class="mx-1">
                        <img src="/images/cards/{{name}}.png" class="my-2 battle-cards" alt="{{name}}" width="100" style="">
                        <p class="my-0" style="text-align: center;">Lvl {{calculateCardLevel level maxLevel}}</p>
                      </div>
                    {{/each}}
                  </div>
                </div>
              {{/if}}
            </div>
          </div>
          <div class="container-fluid">
            <h2 class="mt-4 mb-3">Opposition</h2>
            <div>
              <h3>
                <a href="/players/{{removeFirstCharacter opponent.0.tag}}" class="text-decoration-none">
                  {{opponent.0.name}} [{{opponent.0.tag}}]
                </a>
              </h3>
              <div class="container-fluid mx-0 px-0">
                <div class="row">
                  {{#each opponent.0.cards}}
                    <div class="mx-1">
                      <img src="/images/cards/{{name}}.png" class="my-2 battle-cards" alt="{{name}}" width="100" style="">
                      <p class="my-0" style="text-align: center;">Lvl {{calculateCardLevel level maxLevel}}</p>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
            <div>
              {{#if opponent.1.tag}}
                <h3 class="mt-3 mb-2">
                  <a href="/players/{{removeFirstCharacter opponent.1.tag}}" class="text-decoration-none">
                    {{opponent.1.name}} [{{opponent.1.tag}}]
                  </a>
                </h3>
                <div class="container-fluid mx-0 px-0">
                  <div class="row">
                    {{#each opponent.1.cards}}
                      <div class="mx-1">
                        <img src="/images/cards/{{name}}.png" class="my-2 battle-cards" alt="{{name}}" width="100" style="">
                        <p class="my-0" style="text-align: center;">Lvl {{calculateCardLevel level maxLevel}}</p>
                      </div>
                    {{/each}}
                  </div>
                </div>
              {{/if}}
            </div>
          </div>
          <div class="card-body">
            <h5 class="card-title"><strong>Battle Info</strong></h5>
            <div class="container-fluid mx-0 px-0">
              <div class="row mx-2">
                <div class="col-12 col-sm-6 col-md-3 col-lg-2 mx-1">
                  <h6 class="mb-0"><i>Battle Outcome</i></h6>
                  <p class="mt-0 battle-outcome">{{findVictor team.0.crowns opponent.0.crowns}}</p>
                </div>
                <div class="col-12 col-sm-6 col-md-3 col-lg-2 mx-1">
                  <h6 class="mb-0"><i>Crowns</i></h6>
                  <p class="mt-0" style="color:purple;">{{team.0.crowns}} - {{opponent.0.crowns}}</p>
                </div>
                <div class="col-12 col-sm-6 col-md-3 col-lg-2 mx-1">
                  <h6 class="mb-0"><i>Battle Time</i></h6>
                  <p class="mt-0" style="color: darkblue;">{{dateDifference battleTime}}</p>
                </div>
                <div class="col-12 col-sm-6 col-md-3 col-lg-2 mx-1">
                  <h6 class="mb-0"><i>Average Level Difference</i></h6>
                  <p class="mt-0 level-difference">{{levelDifference team.0.cards team.1.cards opponent.0.cards opponent.1.cards}}</p>
                </div>
                {{#if (compare type "===" "PvP")}}
                  <div class="col-12 col-sm-6 col-md-3 col-lg-2 mx-1">
                    <h6 class="mb-0"><i>Trophy Change</i></h6>
                    {{#if team.0.trophyChange}}
                      <p class="mt-0 trophy-change">{{team.0.startingTrophies}} to {{math team.0.startingTrophies "+" team.0.trophyChange}} [{{team.0.trophyChange}}]</p>
                    {{else}}
                      <p class="mt-0 trophy-change">{{team.0.startingTrophies}} to {{team.0.startingTrophies}}</p>
                    {{/if}}
                  </div>
                {{/if}}
              </div>
            </div>
          </div>
        </div>
      {{/if}}
    {{/each}}
  </div>
  <div class="tab-pane mx-4 my-4" id="cards" role="tabpanel" aria-labelledby="cards-tab">
    <div class="container-fluid mx-0 px-0 d-none d-md-block">
      <!--On large screen, cards will appear as individual parts-->
      <div class="row my-4 justify-content-center">
        <div class="dropdown" style="margin-right: 200px;">
          <button class="btn btn-primary dropdown-toggle" type="button" id="cardSortType" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sort Type
          </button>
          <div class="dropdown-menu" id="cardSortTypeOptions" aria-labelledby="cardSortType">
            <p class="dropdown-item">Name</p>
            <p class="dropdown-item">Level</p>
            <p class="dropdown-item">Rarity</p>
            <p class="dropdown-item">Upgrade</p>
            <p class="dropdown-item">Elixir</p>
            <p class="dropdown-item">Trade</p>
            <p class="dropdown-item mb-0">Star Level</p>
          </div>
        </div>
        <div class="dropdown" style="margin-left: 200px;">
          <button class="btn btn-info dropdown-toggle" type="button" id="cardSortOrder" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sort Order
          </button>
          <div class="dropdown-menu" id="cardSortOrderOptions" aria-labelledby="cardSortOrder">
            <p class="dropdown-item">Ascending</p>
            <p class="dropdown-item mb-0">Descending</p>
          </div>
        </div>
      </div>
      <div class="row justify-content-center" id="cardListDisplay">
        {{#each playerStats.cards}}
          <div class="card mx-2 mb-4 px-3 pb-1 pt-3 bg-light border-primary rounded-lg" style="width: 10em;">
            <h5 class="card-title" style="text-align: center; height:50px;">{{name}}</h5>
            <img src="/images/cards/{{name}}.png" class="card-img-top" alt="{{name}}">
            <div class="card-body">
              <p class="my-0 font-weight-light card-level" style="text-align: center;">Level {{calculateCardLevel level maxLevel}}</p>
              {{#if (compare level "===" maxLevel)}}
                <!--This means that the card in question is at the max level-->
                <p class="my-0 font-weight-light card-count" style="text-align: center;">{{findCardsNeeded level maxLevel}}</p>
                <div class="container-fluid mx-0 px-0">
                  <div class="row justify-content-center">
                    {{{loopHTML starLevel "<img src=\"/images/misc/star_points.png\" class = \"mb-0 mt-3 mx-0\" style = \"width: 25px;\" alt=\"star_points_icon\">"}}}
                  </div>
                </div>
              {{else}}
                <p class="my-0 font-weight-light card-count" style="text-align: center;">{{count}} / {{findCardsNeeded level maxLevel}}</p>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>
    </div>
    <div class="d-block d-md-none">
      <!--On small screens, cards will appear in a table-->
      <div class="alert alert-primary text-center" role="alert">
        Click the column headers to sort the table
      </div>
      <table class="table table-bordered table-striped table-sm" style="width: 100%" id="cards_table">
        <thead class="">
          <tr class="thead-dark text-center">
            <th class="align-middle sortable-column" onclick="sortTable(0)">
              Card Name
              <div>
                <svg class="up-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                </svg>
                <svg class="down-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                </svg>
              </div>
            </th>
            <th class="align-middle">Picture</th>
            <th class="align-middle sortable-column" onclick="sortTable(2)">
              Current Level
              <div>
                <svg class="up-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                </svg>
                <svg class="down-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                </svg>
              </div>
            </th>
            <th class="align-middle sortable-column" onclick="sortTable(3)">
              Card Count
              <div>
                <svg class="up-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                </svg>
                <svg class="down-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                </svg>
              </div>
            </th>
            <th class="align-middle sortable-column" onclick="sortTable(4)">
              Rarity
              <div>
                <svg class="up-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                </svg>
                <svg class="down-arrow-sort d-none" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                </svg>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          {{#each playerStats.cards}}
            <tr class="text-center">
              <td class="align-middle">{{name}}</td>
              <td class="align-middle"><img src="/images/cards/{{name}}.png" style="width: 50px;"></td>
              <td class="align-middle">{{calculateCardLevel level maxLevel}}</td>
              {{#if (compare level "===" maxLevel)}}
                <td class="align-middle">{{findCardsNeeded level maxLevel}}</td>
              {{else}}
                <td class="align-middle">{{count}} / {{findCardsNeeded level maxLevel}}</td>
              {{/if}}
              {{#if (compare maxLevel "===" 13)}}
                <td class="align-middle">Common</td>
              {{else if (compare maxLevel "===" 11)}}
                <td class="align-middle">Rare</td>
              {{else if (compare maxLevel "===" 8)}}
                <td class="align-middle">Epic</td>
              {{else}}
                <td class="align-middle">Legendary</td>
              {{/if}}
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
  <div class="tab-pane mx-4 my-4" id="chests" role="tabpanel" aria-labelledby="chests-tab">
    <div class="container-fluid mx-0 px-0 py-4">
      <div class="row justify-content-center">
        {{#each playerChests.items}}
          <div class="card mx-2 mb-4 px-3 pb-1 pt-3 bg-light border-primary rounded-lg" style="width: 11em;">
            <h5 class="card-title" style="text-align: center; height: 50px;">{{name}}</h5>
            <img src="/images/chests/{{name}} v2.png" class="card-img-top" alt="{{name}}" style="height: 145px;">
            <div class="card-body">
              <p class="my-0 font-weight-light" style="text-align: center;">+{{math index "+" 1}}</p>
            </div>
          </div>
        {{/each}}
      </div>
    </div>
  </div>
  <div class="tab-pane mx-4 my-4" id="analysis" role="tabpanel" aria-labelledby="analysis-tab">
    {{#if isTracked}}
      <div class="alert alert-info text-center">This player is being tracked</div>
      {{#if trackedBattles}}
        <div class="alert alert-warning d-block d-lg-none text-center">
          Analysis tab for a small screen is not supported
        </div>
        <table id="analysisTable" class="table bg-light d-none d-lg-table table-bordered justify-content-center" style="width: 100%">
          <thead>
            <tr class="thead-dark text-center" style="">
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Deck Used<input id="analysisTableSearch0" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(0)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Opponent<input id="analysisTableSearch1" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(1)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Deck Faced<input id="analysisTableSearch2" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(2)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Level Difference<input id="analysisTableSearch3" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(3)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Battle Type<input id="analysisTableSearch4" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(4)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Battle Outcome<input id="analysisTableSearch5" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(5)"></th>
              <th class="align-middle border-dark" style="position: sticky; top: 0;">Time<input id="analysisTableSearch6" class="form-control mt-2" type="search" placeholder="Filter" aria-label="Search" onkeyup="filterAnalysisTable(6)"></th>
            </tr>
          </thead>
          <tbody>
            {{#each trackedBattles}}
              <tr>
                <td class="analysisTableDeckUsed" id="">
                  <div class="container-fluid">
                    <div class="row justify-content-center">
                      {{#each deck_used}}
                        <img src="/images/cards/{{this}}.png" style="width: 60px;" alt="{{this}}">
                      {{/each}}
                    </div>
                  </div>
                </td>
                <td class="align-middle text-center"><a href="/players/{{opponent_tag}}" class="text-decoration-none">{{opponent_tag}}</a></td>
                <td class="analysisTableDeckFaced" id="">
                  <div class="container-fluid">
                    <div class="row justify-content-center">
                      {{#each deck_faced}}
                        <img src="/images/cards/{{this}}.png" style="width: 60px;" alt="{{this}}">
                      {{/each}}
                    </div>
                  </div>
                </td>
                <td class="align-middle text-center level-difference">{{level_difference}}</td>
                <td class="align-middle text-center">{{spaceSeparate battle_type}}</td>
                <td class="align-middle text-center">{{battle_outcome}}</td>
                <td class="align-middle text-center">{{readableDate time}}</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      {{else}}
        <h1>No Tracked Battles</h1>
      {{/if}}
    {{else}}
      <div class="alert alert-info text-center">This player is not being tracked</div>
      <form class="container-fluid mx-0 px-0" action="/players/{{removeFirstCharacter playerStats.tag}}" method="POST">
        <div class="row justify-content-center">
          <button class="btn btn-lg btn-primary" type="submit">Start Tracking Player</button>
        </div>
      </form>
    {{/if}}
  </div>
</div>

<script>
  // Useful global variables
  const commons = ["Archers", "Arrows", "Barbarians", "Bats", "Bomber", "Cannon", "Electro Spirit", "Elite Barbarians", "Fire Spirits", "Firecracker", "Giant Snowball", "Goblin Gang", "Goblins", "Ice Spirit", "Knight", "Minion Horde", "Minions", "Mortar", "Rascals", "Royal Delivery", "Royal Giant", "Royal Recruits", "Skeleton Barrel", "Skeleton Dragons", "Skeletons", "Spear Goblins", "Tesla", "Zap"];
  const rares = ["Barbarian Hut", "Battle Healer", "Battle Ram", "Bomb Tower", "Dart Goblin", "Earthquake", "Elixir Collector", "Elixir Golem", "Fireball", "Flying Machine", "Furnace", "Giant", "Goblin Cage", "Goblin Hut", "Heal Spirit", "Hog Rider", "Ice Golem", "Inferno Tower", "Mega Minion", "Mini P.E.K.K.A", "Musketeer", "Rocket", "Royal Hogs", "Three Musketeers", "Tombstone", "Valkyrie", "Wizard", "Zappies"];
  const epics = ["Baby Dragon", "Balloon", "Barbarian Barrel", "Bowler", "Cannon Cart", "Clone", "Dark Prince", "Electro Dragon", "Electro Giant", "Executioner", "Freeze", "Giant Skeleton", "Goblin Barrel", "Goblin Giant", "Golem", "Guards", "Hunter", "Lightning", "Mirror", "P.E.K.K.A", "Poison", "Prince", "Rage", "Skeleton Army", "Tornado", "Wall Breakers", "Witch", "X-Bow"];
  const legendarys = ["Bandit", "Electro Wizard", "Fisherman", "Graveyard", "Ice Wizard", "Inferno Dragon", "Lava Hound", "Lumberjack", "Magic Archer", "Mega Knight", "Miner", "Mother Witch", "Night Witch", "Princess", "Ram Rider", "Royal Ghost", "Sparky", "The Log"];

  const zeroElixir = ["Mirror"];
  const oneElixir = ["Electro Spirit", "Heal Spirit", "Ice Spirit", "Skeletons"];
  const twoElixir = ["Barbarian Barrel", "Bats", "Fire Spirits", "Giant Snowball", "Goblins", "Ice Golem", "Rage", "Spear Goblins", "The Log", "Wall Breakers", "Zap"];
  const threeElixir = ["Archers", "Arrows", "Bandit", "Bomber", "Cannon", "Clone", "Dart Goblin", "Earthquake", "Elixir Golem", "Firecracker", "Fisherman", "Goblin Barrel", "Goblin Gang", "Guards", "Ice Wizard", "Knight", "Mega Minion", "Miner", "Minions", "Princess", "Royal Delivery", "Royal Ghost", "Skeleton Army", "Skeleton Barrel", "Tombstone", "Tornado"];
  const fourElixir = ["Baby Dragon", "Battle Healer", "Battle Ram", "Bomb Tower", "Dark Prince", "Electro Wizard", "Fireball", "Flying Machine", "Freeze", "Furnace", "Goblin Cage", "Hog Rider", "Hunter", "Inferno Dragon", "Lumberjack", "Magic Archer", "Mini P.E.K.K.A", "Mortar", "Mother Witch", "Musketeer", "Night Witch", "Poison", "Skeleton Dragons", "Tesla", "Valkyrie", "Zappies"];
  const fiveElixir = ["Balloon", "Barbarians", "Bowler", "Cannon Cart", "Electro Dragon", "Executioner", "Giant", "Goblin Hut", "Graveyard", "Inferno Tower", "Lightning", "Minion Horde", "Prince", "Ram Rider", "Rascals", "Rocket", "Royal Hogs", "Witch", "Wizard"];
  const sixElixir = ["Elite Barbarians", "Elixir Collector", "Giant Skeleton", "Goblin Giant", "Royal Giant", "Sparky", "X-Bow"];
  const sevenElixir = ["Barbarian Hut", "Lava Hound", "Mega Knight", "P.E.K.K.A", "Royal Recruits"];
  const eightElixir = ["Electro Giant", "Golem"];
  const nineElixir = ["Three Musketeers"];

  // This area is for custom classes that I use to save space (define bootstrap class list here instead of repeating it)
  $(".challengeRoyaleCardStyle").addClass("card mx-2 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".challengeRoyaleCardStyle").css({"width": "19rem", "background-color": "mintcream"});
  $(".leagueRoyaleCardStyle").addClass("card mx-3 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".leagueRoyaleCardStyle").css({"width": "20rem", "background-color": "mintcream"});
  $(".clanRoyaleCardStyle").addClass("card mx-4 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".clanRoyaleCardStyle").css({"width": "20rem", "background-color": "mintcream"});
  $(".battleRoyaleCardStyle").addClass("card mx-2 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".battleRoyaleCardStyle").css({"width": "19rem", "background-color": "mintcream"});
  $(".badgeRoyaleCardStyle").addClass("card mx-1 mb-4 px-2 pb-1 pt-3 border-primary rounded-lg");
  $(".badgeRoyaleCardStyle").css({"width": "8rem", "background-color": "mintcream"});
  $(".badge-royale-image").css({"height": "112px"});
  $(".achievementRoyaleCardStyle").addClass("card mx-2 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".achievementRoyaleCardStyle").css({"width": "16rem", "background-color": "mintcream"});
  $(".miscellaneousRoyaleCardStyle").addClass("card mx-2 mb-4 px-3 pb-1 pt-3 border-primary rounded-lg");
  $(".miscellaneousRoyaleCardStyle").css({"width": "15rem", "background-color": "mintcream"});
  if (window.innerWidth > 768) {
    $(".badgeRoyaleCardStyle").removeClass("mx-1 px-2").addClass("mx-2 px-3");
    $(".badgeRoyaleCardStyle").css({"width": "10rem"});
    $(".badge-royale-image").css({"height": "140px"});
  }

  // This code is used to initialize the tooltips (code taken from: https://getbootstrap.com/docs/5.0/components/tooltips/)
  let tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  let tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  });

  // playerStats, playerBattles, and playerChests are the three info pieces sent to the HTML document
  $(".battle-cards").css("width", (0.075 * (window.innerWidth - 500) + 75));
  window.onresize = function () {
    $(".battle-cards").css("width", (0.075 * (window.innerWidth - 500) + 75));
    if (window.innerWidth > 768) {
      $(".badgeRoyaleCardStyle").removeClass("mx-1 px-2").addClass("mx-2 px-3");
      $(".badgeRoyaleCardStyle").css({"width": "10rem"});
      $(".badge-royale-image").css({"height": "140px"});
    } else {
      $(".badgeRoyaleCardStyle").removeClass("mx-2 px-3").addClass("mx-1 px-2");
      $(".badgeRoyaleCardStyle").css({"width": "8rem"});
      $(".badge-royale-image").css({"height": "112px"});
    }
  }
  $(".battle-outcome").css("color", function() {
    if($(this).text() === "Defeat") {
      return ("red");
    }
    if($(this).text() === "Victory") {
      return ("green");
    }
    return ("gray");
  });
  $(".level-difference").css("color", function() {
    if(parseFloat($(this).text()) < 0) {
      return ("red");
    }
    if(parseFloat($(this).text()) > 0) {
      return ("green");
    }
    return ("gray");
  });
  $(".trophy-change").css("color", function() {
    if($(this).text().includes("-")) {
      return ("red");
    }
    if(!$(this).text().includes("[")){
      return ("gray");
    }
    return ("green");
  });

  // This code is for the sort feature on the table
  let directions = [1, Number.NEGATIVE_INFINITY, 1, 1, 1];
  function sortTable(n) {
    directions[n] = (directions[n] + 1) % 2;
    let table = document.getElementById("cards_table");
    let newTable;
    let rows = table.rows;
    let dir = directions[n];
    // This code segment toggles the up and down arrows
    let upArrows = document.getElementsByClassName("up-arrow-sort");
    let downArrows = document.getElementsByClassName("down-arrow-sort");
    for (let i = 0; i < 4; i++) {
      upArrows[i].classList.add("d-none");
      downArrows[i].classList.add("d-none");
    }
    let arrowIndex = n;
    if (n > 1) {
      arrowIndex--;
    }
    if (directions[n] === 0) {
      upArrows[arrowIndex].classList.remove("d-none");
    } else {
      downArrows[arrowIndex].classList.remove("d-none");
    }
    // This is the actual sort algorithm
    for (let i = 1; i < rows.length - 1; i++) {
      let toAddIndex = i;
      let toAdd;
      if (n === 0) {
        toAdd = rows[i].getElementsByTagName("TD")[n].innerHTML.toLowerCase();
      } else {
        toAdd = rows[i].getElementsByTagName("TD")[n].innerHTML;
        if (n === 2) {
          toAdd = parseInt(toAdd);
        } else if (n === 3) {
          if (toAdd === "MAX") {
            toAdd = 1000000;
          } else {
            toAdd = toAdd.replace("/", "");
            let arr = toAdd.split(" ");
            toAdd = parseInt(arr[0]) / parseInt(arr[2]);
          }
        } else if (n === 4) {
          switch (toAdd) {
            case "Common": {
              toAdd = 1;
              break;
            }
            case "Rare": {
              toAdd = 2;
              break;
            }
            case "Epic": {
              toAdd = 3;
              break;
            }
            case "Legendary": {
              toAdd = 4;
              break;
            }
            default: {
              toAdd = 0;
              break;
            }
          }
        }
      }
      for (let j = i + 1; j < rows.length; j++) {
        let toCheck;
        if (n === 0) {
          toCheck = rows[j].getElementsByTagName("TD")[n].innerHTML.toLowerCase();
        } else {
          toCheck = rows[j].getElementsByTagName("TD")[n].innerHTML;
          if (n === 2) {
            toCheck = parseInt(toCheck);
          } else if (n === 3) {
            if (toCheck === "MAX") {
              toCheck = 1000000;
            } else {
              toCheck = toCheck.replace("/", "");
              let arr2 = toCheck.split(" ");
              toCheck = parseInt(arr2[0]) / parseInt(arr2[2]);
            }
          } else if (n === 4) {
            switch (toCheck) {
              case "Common": {
                toCheck = 1;
                break;
              }
              case "Rare": {
                toCheck = 2;
                break;
              }
              case "Epic": {
                toCheck = 3;
                break;
              }
              case "Legendary": {
                toCheck = 4;
                break;
              }
              default: {
                toCheck = 0;
                break;
              }
            }
          }
        }
        if (dir === 0 && toCheck < toAdd) {
            toAddIndex = j;
            toAdd = toCheck;
        } else if (dir === 1 && toCheck > toAdd) {
            toAddIndex = j;
            toAdd = toCheck;
        }
      }
      if (i !== toAddIndex) {
        rows[i].parentNode.insertBefore(rows[toAddIndex], rows[i]);
        rows[i + 1].parentNode.insertBefore(rows[i + 1], rows[toAddIndex + 1]);
      }
    }
  }

  // Dropdown Menu JS (Cards section, large screen)
  $("#cardSortTypeOptions p").on("click", function (e) {
    let selectedText = $(this).text();
    if($("#cardSortType").text() !== selectedText) {
      $("#cardSortType").text(selectedText);
      if (!$("#cardSortOrder").text().includes("Sort Order")) {
        sortCards();
      }
    }
  });
  $("#cardSortOrderOptions p").on("click", function (e) {
    let selectedText = $(this).text();
    if($("#cardSortOrder").text() !== selectedText) {
      $("#cardSortOrder").text(selectedText);
      if (!$("#cardSortType").text().includes("Sort Type")) {
        sortCards();
      }
    }
  });

  function sortCards() {
    let sortType = $("#cardSortType").text();
    let sortOrder = $("#cardSortOrder").text();
    const upgradeOrder = [2, 4, 10, 20, 50, 100, 200, 400, 800, 1000, 2000, 5000];

    
    // Got the general sorting code from: http://jsfiddle.net/hibbard_eu/C2heg/
    switch (sortType) {
      case ("Name"): {
        if (sortOrder === "Ascending") {
          $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
            return $(a).find("h5").text() > $(b).find("h5").text();
          }));
        } else {
          $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
            return $(a).find("h5").text() < $(b).find("h5").text();
          }));
        }
        break;
      }
      case ("Level"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let num1 = parseInt($(a).find(".card-level").text().substring(6));
          let num2 = parseInt($(b).find(".card-level").text().substring(6));
          if (num1 < num2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (num1 > num2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
      case ("Upgrade"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let text1 = $(a).find(".card-count").text();
          let text2 = $(b).find(".card-count").text();
          let percent1 = -1;
          let percent2 = -1;
          // Set large percent if card is already maxed
          if (text1 === "MAX") {
            percent1 = 1000000;
          }
          if (text2 === "MAX") {
            percent2 = 1000000;
          }
          // Calculate percent if card is not maxed
          if (percent1 === -1) {
            text1 = text1.replace("/", "");
            let arr = text1.split(" ");
            percent1 = parseInt(arr[0]) / parseInt(arr[2]);
          }
          if (percent2 === -1) {
            text2 = text2.replace("/", "");
            let arr = text2.split(" ");
            percent2 = parseInt(arr[0]) / parseInt(arr[2]);
          }
          if (percent1 < percent2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (percent1 > percent2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
      case ("Rarity"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let rarity1 = getRarity($(a).find("h5").text());
          let rarity2 = getRarity($(b).find("h5").text());
          if (rarity1 < rarity2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (rarity1 > rarity2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
      case ("Elixir"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let elixir1 = getElixirCost($(a).find("h5").text());
          let elixir2 = getElixirCost($(b).find("h5").text());
          if (elixir1 < elixir2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (elixir1 > elixir2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
      case ("Trade"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let text1 = $(a).find(".card-count").text();
          let text2 = $(b).find(".card-count").text();
          let trade1 = -1;
          let trade2 = -1;
          // Set large trade if card is already maxed
          if (text1 === "MAX") {
            trade1 = 1000000;
          }
          if (text2 === "MAX") {
            trade2 = 1000000;
          }
          // Calculate number of possible trades if card is not maxed
          if (trade1 === -1) {
            text1 = text1.replace("/", "");
            let arr = text1.split(" ");
            trade1 = getTrades(parseInt(arr[0]), getRarity($(a).find("h5").text()), parseInt($(a).find(".card-level").text().substring(6)));
          }
          if (trade2 === -1) {
            text2 = text2.replace("/", "");
            let arr = text2.split(" ");
            trade2 = getTrades(parseInt(arr[0]), getRarity($(b).find("h5").text()), parseInt($(b).find(".card-level").text().substring(6)));
          }
          if (trade1 < trade2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (trade1 > trade2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
      case ("Star Level"): {
        $("#cardListDisplay").html($("#cardListDisplay").children().sort(function (a, b) {
          let starLevel1 = $(a).find("img").length - 1;
          let starLevel2 = $(b).find("img").length - 1;
          let level1 = parseInt($(a).find(".card-level").text().substring(6));
          let level2 = parseInt($(b).find(".card-level").text().substring(6));

          // Ensures that non-maxed cards come before maxed cards in the sort
          if (starLevel1 === 0 && level1 !== 13) {
            starLevel1--;
          }
          if (starLevel2 === 0 && level2 !== 13) {
            starLevel2--;
          }
          
          if (starLevel1 < starLevel2) {
            return (sortOrder === "Ascending") ? -1 : 1;
          } else if (starLevel1 > starLevel2) {
            return (sortOrder === "Ascending") ? 1 : -1;
          } else {
            return 0;
          }
        }));
        break;
      }
    }
  }

  // This function filters the data from the table in the Analysis Tab
  // Implementation is taken from: https://www.w3schools.com/howto/howto_js_filter_table.asp
  /*function filterAnalysisTable(col) {
    if (col !== 0 && col !== 2) {
      // Column is not a deck (no pictures to worry about)
      let filterID = "analysisTableSearch" + col;
      let filter = document.getElementById(filterID).value.toUpperCase();
      let tableRows = document.getElementById("analysisTable").rows;
      for (let i = 1; i < tableRows.length; i++) {
        let tableData = tableRows[i].getElementsByTagName("td")[col].innerText;
        if (tableData.toUpperCase().includes(filter)) {
          tableRows[i].style.display = "";
        } else {
          tableRows[i].style.display = "none";
        }
      }
    } else {
      // Column is a deck and will be filtered using the pictures' alt text
      let filterID = "analysisTableSearch" + col;
      let filter = document.getElementById(filterID).value.toUpperCase().split(" ");
      let tableRows = document.getElementById("analysisTable").rows;
      let toSearch = "";
      toSearch = (col === 0) ? (".analysisTableDeckUsed") : (".analysisTableDeckFaced");
      $(toSearch).each(function () {
        let tableData = "";
        $(this).find("div div img").each(function () {
          tableData += $(this).attr("alt") + " ";
        });
        let toShow = true;
        for (let i = 0; i < filter.length; i++) {
          if (!tableData.toUpperCase().includes(filter[i])) {
            toShow = false;
            break;
          }
        }
        if (toShow) {
          $(this).parent().css("display", "");
        } else {
          $(this).parent().css("display", "none");
        }
      });
    }
  }*/

  // Reworked filter function for analysis table
  function filterAnalysisTable(notNeeded) {
    let filters = [];
    let tableRows = document.getElementById("analysisTable").rows;
    for (let i = 1; i < tableRows.length; i++) {
      tableRows[i].style.display = "";
    }
    for (let i = 0; i < 7; i++) {
      let tmp = document.getElementById("analysisTableSearch" + i).value.toUpperCase();
      filters.push((i === 0 || i === 2) ? tmp.split(" ") : tmp);
    }
    /*for (let i = 1; i < tableRows.length; i++) {
      console.log(tableRows[i].style.display);
    }*/
    for (let i = 0; i < filters.length; i++) {
      if (i === 0 || i === 2) {
        let toSearch = (i === 0) ? (".analysisTableDeckUsed") : (".analysisTableDeckFaced");
        $(toSearch).each(function () {
          let tableData = "";
          $(this).find("div div img").each(function () {
            tableData += $(this).attr("alt") + " ";
          });
          let toShow = true;
          for (let j = 0; j < filters[i].length; j++) {
            //console.log(filters[i][j]);
            if (!tableData.toUpperCase().includes(filters[i][j])) {
              toShow = false;
              break;
            }
          }
          //console.log(tableData + " " + toShow);
          //console.log($(this).parent());
          //console.log($(this).parent().css("display"));
          /*if (toShow && $(this).parent().css("display") !== "none") {
            $(this).parent().css("display", "");
          } else {
            $(this).parent().css("display", "none");
          }*/
          if (!toShow) {
            $(this).parent().css("display", "none");
          }
        });
      } else {
        //let tableRows = document.getElementById("analysisTable").rows;
        for (let j = 1; j < tableRows.length; j++) {
          let tableData = tableRows[j].getElementsByTagName("td")[i].innerText;
          /*if (tableData.toUpperCase().includes(filters[i]) && tableRows[i].style.display !== "none") {
            tableRows[i].style.display = "";
          } else {
            tableRows[i].style.display = "none";
          }*/
          if (!tableData.toUpperCase().includes(filters[i])) {
            tableRows[j].style.display = "none";
          }
        }
      }
    }
  }

  // These are useful helper functions
  function getElixirCost(cardName) {
    switch (true) {
      case ($.inArray(cardName, zeroElixir) > -1): {
        return 0;
      }
      case ($.inArray(cardName, oneElixir) > -1): {
        return 1;
      }
      case ($.inArray(cardName, twoElixir) > -1): {
        return 2;
      }
      case ($.inArray(cardName, threeElixir) > -1): {
        return 3;
      }
      case ($.inArray(cardName, fourElixir) > -1): {
        return 4;
      }
      case ($.inArray(cardName, fiveElixir) > -1): {
        return 5;
      }
      case ($.inArray(cardName, sixElixir) > -1): {
        return 6;
      }
      case ($.inArray(cardName, sevenElixir) > -1): {
        return 7;
      }
      case ($.inArray(cardName, eightElixir) > -1): {
        return 8;
      }
      case ($.inArray(cardName, nineElixir) > -1): {
        return 9;
      }
    }
  }

  function getRarity(cardName) {
    switch (true) {
      case ($.inArray(cardName, commons) > -1): {
        return 1;
      }
      case ($.inArray(cardName, rares) > -1): {
        return 2;
      }
      case ($.inArray(cardName, epics) > -1): {
        return 3;
      }
      case ($.inArray(cardName, legendarys) > -1): {
        return 4;
      }
    }
  }

  function getTrades(count, rarity, level) {
    switch (rarity) {
      case (1): {
        return Math.floor(count / 250);
      }
      case (2): {
        return Math.floor(count / 50);
      }
      case (3): {
        return Math.floor(count / 10);
      }
      case (4): {
        if (level === 9) {
          return 0;
        }
        return (count);
      }
    }
  }
</script>