<title>Clan Search</title>

<!--This initializes the tooltips on the page-->
<script defer src="/js/bootstrapTooltips.js"></script>
<!--This is for the hover functionality on the clan cards-->
<script defer src="/js/hoverCard.js"></script>
<!--This script contains the page-specific JS required to run the page-->
<script defer src="/js/clans.js"></script>
<!--The next three links are for DataTables, a JQuery plug-in-->
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" crossorigin="anonymous">
<script defer src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script defer src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
<!--The next two lines are for a plugin that converts checkboxes into toggles-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css">
<script defer src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

{{> _breadcrumbPath path=path rawData=""}}

{{#each errors}}
  <div class="alert alert-danger mx-4 text-center">{{this}}</div>
{{/each}}

{{#if results}}
  <!--Displaying Results-->

  <!--This is a toggle that lets the user select between card view and table view-->
  <!--Default is table view-->
  <div class="container-fluid d-flex justify-content-center mt-4">
    <input id="searchDisplayFormat" style="mx-auto" type="checkbox" data-toggle="toggle" data-onstyle="outline-info" data-offstyle="outline-dark" data-on="Table" data-off="Cards" data-size="lg" checked>
    <button type="button" class="btn btn-primary ml-5" data-toggle="modal" data-target="#viewSettings">
      Change Viewable Data
    </button>
  </div>

  <!--This is for the modal that lets the user select what info they want visible-->
  <div class="modal fade" id="viewSettings" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="viewSettingsLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title font-weight-bold" id="viewSettingsLabel">Data View Settings</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-toggle-div">
            <h5>Display Clan Badge: </h5>
            <input class="display-toggle" data-column="0" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Name: </h5>
            <input class="display-toggle" data-column="1" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Tag: </h5>
            <input class="display-toggle" data-column="2" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Type: </h5>
            <input class="display-toggle" data-column="3" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Location: </h5>
            <input class="display-toggle" data-column="4" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Required Trophies: </h5>
            <input class="display-toggle" data-column="5" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Donations Per Week: </h5>
            <input class="display-toggle" data-column="6" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Clan Score: </h5>
            <input class="display-toggle" data-column="7" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Clan War Trophies: </h5>
            <input class="display-toggle" data-column="8" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
          <div class="modal-toggle-div">
            <h5>Display Members: </h5>
            <input class="display-toggle" data-column="9" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" data-dismiss="modal">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <div id="cards" class="container-fluid my-3 d-none">
    <div class="row justify-content-center">
      {{#each results.items}}
        <a href="/clans/{{removeFirstCharacter tag}}" class="text-decoration-none" style="color: black; margin: 10px;">
          <div class="card hover-card border-primary" style="width: 22em; background-color: ghostwhite;">
            <div class="row no-gutters">
              <div class="col-4 d-flex align-items-center">
                <img src="{{getClanBadge badgeId clanWarTrophies}}" class="card-img-top card-data-0" alt="Clan Badge">
              </div>
              <div class="col-8">
                <div class="card-body">
                  <h5 class="card-title font-weight-bold mb-1 card-data-1">{{name}}</h5>
                  <h6 class="font-weight-light font-italic mb-2 card-data-2">{{tag}}</h6>
                  <div class="row">
                    <div class="col-12 mb-2 card-data-3" style="height: 20px;">
                      <img src="/images/misc/person_icon.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Type" alt="Person Icon" height="20px;">
                      <p class="card-text d-inline-block align-middle" style="line-height: 20px;">{{correctCapitalization type}}</p>
                    </div>
                    <div class="col-12 mb-1 card-data-4 d-flex align-items-center" style="">
                      <img src="/images/misc/locations.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Location" alt="Location" height="20px;">
                      <p class="card-text pl-2" style="font-size: 0.8em;">{{location.name}}</p>
                    </div>
                    <div class="col-6 mb-2 card-data-5" style="height: 20px;">
                      <img src="/images/ladder/trophy.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Required Trophies" alt="Required Trophies" height="20px;">
                      <p class="card-text d-inline-block align-middle" style="line-height: 20px;">{{requiredTrophies}}</p>
                    </div>
                    <div class="col-6 mb-2 card-data-6" style="height: 20px;">
                      <img src="/images/misc/donations_given.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Weekly Donations" alt="Weekly Donations" height="20px;">
                      <p class="card-text d-inline-block align-middle" style="line-height: 20px;">{{donationsPerWeek}}</p>
                    </div>
                    <div class="col-6 mb-2 card-data-7" style="height: 25px;">
                      <img src="/images/badges/Tournament.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Clan Score" alt="Clan Score" height="25px;">
                      <p class="card-text d-inline-block align-middle" style="line-height: 25px;">{{clanScore}}</p>
                    </div>
                    <div class="col-6 mb-2 card-data-8" style="height: 25px;">
                      <img src="/images/clans/Clan Trophies.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Clan War Trophies" alt="Clan War Trophies" height="25px;">
                      <p class="card-text d-inline-block align-middle" style="line-height: 25px;">{{clanWarTrophies}}</p>
                    </div>
                    <div class="col-6 mb-2 card-data-9" style="height: 25px;">
                      <img src="/images/clans/clans.png" data-bs-toggle="tooltip" data-bs-placement="top" title="Members" alt="Members" height="25px;">
                      <p class="card-text d-inline-block align-middle ml-1" style="line-height: 25px;">{{members}} / 50</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </a>
      {{/each}}
    </div>
  </div>
  <div id="tableDiv" class="container-fluid mt-3 px-0 py-2 px-lg-4 mb-5 table-responsive" style="">
    <table id="table" class="table table-bordered table-striped justify-content-center" style="width: 100%;">
      <thead>
        <tr class="thead-dark text-center">
          <th>Badge</th>
          <th>Name</th>
          <th>Tag</th>
          <th>Type</th>
          <th>Location</th>
          <th>Required Trophies</th>
          <th>Donations Per Week</th>
          <th>Clan Score</th>
          <th>Clan War Trophies</th>
          <th>Members</th>
        </tr>
      </thead>
      <tbody>
        {{#each results.items}}
          <tr class="text-center">
            <td class="align-middle"><img src="{{getClanBadge badgeId clanWarTrophies}}" class="" alt="Clan Badge" style="width: 50px;"></td>
            <td class="align-middle"><a href="/clans/{{removeFirstCharacter tag}}" class="text-decoration-none">{{name}}</a></td>
            <td class="align-middle">{{tag}}</td>
            <td class="align-middle">{{correctCapitalization type}}</td>
            <td class="align-middle">{{location.name}}</td>
            <td class="align-middle">{{requiredTrophies}}</td>
            <td class="align-middle">{{donationsPerWeek}}</td>
            <td class="align-middle">{{clanScore}}</td>
            <td class="align-middle">{{clanWarTrophies}}</td>
            <td class="align-middle">{{members}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
{{else}}
  <!--Displaying the Form-->
  <h1 class="mx-4 text-center mt-2 mb-4">Clan Search</h1>

  <h3 class="mx-4 font-weight-light">Search by Clan Tag</h3>

  <div class="container-fluid d-none d-md-block">
    <form class="form-inline my-2" action="/clans" method="POST">
      <input class="form-control mx-2" type="text" name="tag" placeholder="ENTER CLAN TAG" aria-label="Search" required>
      <button class="btn btn-primary my-2 mr-2" type="submit">Search</button>
    </form>
  </div>

  <div class="container-fluid d-block d-md-none">
    <form class="my-2 text-center" action="/clans" method="POST">
      <input class="form-control" type="text" name="tag" placeholder="ENTER CLAN TAG" aria-label="Search" required>
      <button class="btn btn-primary my-2 mr-2" type="submit">Search</button>
    </form>
  </div>

  <h3 class="mx-4 my-3">OR</h3>

  <h3 class="mx-4 font-weight-light">Search by Filters</h3>

  <div class="container-fluid" style="background-color: white;">
    <form class="my-2 ml-3" actions="/clans" method="POST">
      <div class="form-group">
        <label for="name">Name</label>
        <input class="form-control" type="text" id="name" name="name" placeholder="ENTER CLAN NAME" aria-describedby="nameInfo" minlength="3">
        <small id="nameInfo" class="form-text text-muted">Entered name must be at least three characters</small>
      </div>
      <div class="form-group">
        <label class="" for="location">Location</label>
        <input class="form-control" list="locationInfo" type="text" name="location" id="location">
        <datalist class="" id="locationInfo">
          {{#each locations.items}}
            <option class="" value="{{name}}">
          {{/each}}
        </datalist>
      </div>
      <div class="form-group">
        <label for="minMembers">Minimum Members</label>
        <input class="form-control" type="number" name="minMembers" id="minMembers" placeholder="Minimum Member Count" min=2 max=50>
      </div>
      <div class="form-group">
        <label for="maxMembers">Maximum Members</label>
        <input class="form-control" type="number" name="maxMembers" id="maxMembers" placeholder="Maximum Member Count" min=2 max=50>
      </div>
      <div class="form-group">
        <label for="minScore">Minimum Clan Score</label>
        <input class="form-control" type="number" name="minScore" id="minScore" placeholder="Minimum Clan Score" min=1 max=100000>
      </div>
      <div class="form-group">
        <label for="resultsReturned">Results Returned</label>
        <input class="form-control" type="number" name="limit" id="resultsReturned" placeholder="Results Returned" min=0 aria-describedby="resultsReturnedInfo">
        <small id="resultsReturnedInfo" class="form-text text-muted">Leave blank to return maximum results</small>
      </div>
      <button class="btn btn-primary my-2 mr-2" type="submit">Search</button>
    </form>
  </div>
{{/if}}


